<script>
    const API_URL = "https://script.google.com/macros/s/AKfycbwjFWCc91TE4c5macmjF7y8lOOJlpi3glOSWQkIn2aljCWkBboc1hN1MgHeCEiWb-V5/exec";

    const form = document.getElementById('expenseForm');
    const tableBody = document.querySelector('#expenseTable tbody');

    const entryScreen = document.getElementById('entryScreen');
    const historyScreen = document.getElementById('historyScreen');

    // Format date as M/D/YYYY
    function formatDate(dateString) {
        const d = new Date(dateString);
        const month = d.getMonth() + 1;
        const day = d.getDate();
        const year = d.getFullYear();
        return `${month}/${day}/${year}`;
    }

    function showHistory() {
        entryScreen.style.display = "none";
        historyScreen.style.display = "block";
        loadExpenses();
    }

    function showEntry() {
        historyScreen.style.display = "none";
        entryScreen.style.display = "block";
    }

    async function loadExpenses() {
        const response = await fetch(API_URL);
        const data = await response.json();

        data.sort((a, b) => new Date(b.date) - new Date(a.date));

        tableBody.innerHTML = '';

        data.forEach(exp => {
            const amountFormatted = `$${parseFloat(exp.amount).toFixed(2)}`;

            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${formatDate(exp.date)}</td>
                <td>${exp.user}</td>
                <td>${amountFormatted}</td>
                <td>${exp.description}</td>
                <td>${exp.reimbursed === "true" ? "Yes" : "No"}</td>
            `;
            tableBody.appendChild(row);
        });
    }

    form.addEventListener('submit', async function(e) {
        e.preventDefault();

        const newExpense = {
            date: document.getElementById('date').value,
            user: document.getElementById('user').value,
            amount: document.getElementById('amount').value,
            description: document.getElementById('description').value,
            reimbursed: document.getElementById('reimbursed').checked
        };

        await fetch(API_URL, {
            method: "POST",
            body: JSON.stringify(newExpense)
        });

        form.reset();
    });
</script>
